fill = ethnicity %>% factor(levels = rev(unique(bay_education_ethnicity_2019$race)))
),
stat = "identity",
position = "fill"
) +
labs(
x = "Educational Attainment",
y = "Proportion of Population 25 years or older",
title = "San Mateo County Educational Attainment by race",
fill = "Ethnicity"
) +
coord_flip() +
theme(
legend.position = "bottom",
legend.direction = "vertical"
)  +
guides(
fill = guide_legend(
reverse = T
)
)
bay_education_ethnicity_2019_stacked <- ##Lets you add a total ethnicity
bay_education_ethnicity_2019 %>%
rbind(bay_education_ethnicity_2019
%>%
group_by(ethnicity) %>%
summarize(estimate = sum(estimate)) %>%
mutate(education = "Total")
) %>%
ggplot() +
geom_bar(
aes(
x = education%>% factor(levels = rev(c(
"Total",
"Less than high school diploma",
"High school graduate (includes equivalency)",
"Some college or associate's degree",
"Bachelor's degree or higher"
))),
y = estimate,
fill = ethnicity %>% factor(levels = rev(c(
"Latinx",
"White Not Latinx",
"Not White, Not Latinx"
)))
),
stat = "identity",
position = "stack"
) +
labs(
x = "Educational attainment",
y = "Population 25 years or older",
title = "Bay Area educational attainment by ethnicity",
fill = "Ethnicity"
) +
coord_flip() +
theme(
legend.position = "bottom",
legend.direction = "vertical"
) +
guides(
fill = guide_legend(
reverse = T
)
)
bay_education_ethnicity_2019_fill <-
bay_education_ethnicity_2019
bay_education_ethnicity_2019_stacked
bay_education_ethnicity_2019_fill
View(bay_education_ethnicity_2019)
View(bay_education_ethnicity_2019_fill)
View(bay_education_ethnicity_2019_stacked)
View(bay_education_ethnicity_2019_fill)
View(bay_education_ethnicity_2019)
View(bay_education_ethnicity_2019)
bay_education_ethnicity_2019_stacked <- ##Lets you add a total ethnicity
bay_education_ethnicity_2019 %>%
rbind(bay_education_ethnicity_2019
%>%
group_by(ethnicity) %>%
summarize(estimate = sum(estimate)) %>%
mutate(education = "Total")
) %>%
ggplot() +
geom_bar(
aes(
x = education%>% factor(levels = rev(c(
"Total",
"Less than high school diploma",
"High school graduate (includes equivalency)",
"Some college or associate's degree",
"Bachelor's degree or higher"
))),
y = estimate,
fill = ethnicity %>% factor(levels = rev(c(
"Latinx",
"White Not Latinx",
"Not White, not Latinx"
)))
),
stat = "identity",
position = "stack"
) +
labs(
x = "Educational attainment",
y = "Population 25 years or older",
title = "Bay Area educational attainment by ethnicity",
fill = "Ethnicity"
) +
coord_flip() +
theme(
legend.position = "bottom",
legend.direction = "vertical"
) +
guides(
fill = guide_legend(
reverse = T
)
)
bay_education_ethnicity_2019_fill <-
bay_education_ethnicity_2019
bay_education_ethnicity_2019_stacked
bay_education_ethnicity_2019_fill
bay_education_ethnicity_2019_stacked <- ##Lets you add a total ethnicity
bay_education_ethnicity_2019 %>%
rbind(bay_education_ethnicity_2019
%>%
group_by(ethnicity) %>%
summarize(estimate = sum(estimate)) %>%
mutate(education = "Total")
) %>%
ggplot() +
geom_bar(
aes(
x = education %>% factor(levels = rev(c("Total",unique(bay_education_ethnicity_2019$education)))),
y = estimate,
fill = ethnicity %>% factor(levels = rev(unique(bay_education_ethnicity_2019$ethnicity)))
),
stat = "identity",
position = "stack"
) +
labs(
x = "Educational attainment",
y = "Population 25 years or older",
title = "Bay Area educational attainment by ethnicity",
fill = "Ethnicity"
) +
coord_flip() +
theme(
legend.position = "bottom",
legend.direction = "vertical"
) +
guides(
fill = guide_legend(
reverse = T
)
)
bay_education_ethnicity_2019_fill <-
bay_education_ethnicity_2019
bay_education_ethnicity_2019_stacked
bay_education_ethnicity_2019_fill
bay_education_ethnicity_2019_stacked <- ##Lets you add a total ethnicity
bay_education_ethnicity_2019 %>%
rbind(bay_education_ethnicity_2019
%>%
group_by(ethnicity) %>%
summarize(estimate = sum(estimate)) %>%
mutate(education = "Total")
) %>%
ggplot() +
geom_bar(
aes(
x = education %>% factor(levels = rev(c("Total", unique(bay_education_ethnicity_2019$education)))),
y = estimate,
fill = ethnicity %>% factor(levels = rev(unique(bay_education_ethnicity_2019$ethnicity)))
),
stat = "identity",
position = "stack"
) +
labs(
x = "Educational attainment",
y = "Proportion of Population 25 years or older",
title = "Bay Area educational attainment by ethnicity",
fill = "Ethnicity"
) +
coord_flip() +
theme(
legend.position = "bottom",
legend.direction = "vertical"
) +
guides(
fill = guide_legend(
reverse = T
)
)
bay_education_ethnicity_2019_stacked <- ##Lets you add a total ethnicity
bay_education_ethnicity_2019 %>%
rbind(bay_education_ethnicity_2019
%>%
group_by(ethnicity) %>%
summarize(estimate = sum(estimate)) %>%
mutate(education = "Total")
) %>%
ggplot() +
geom_bar(
aes(
x = education %>% factor(levels = rev(c("Total", unique(bay_education_ethnicity_2019$education)))),
y = estimate,
fill = ethnicity %>% factor(levels = rev(unique(bay_education_ethnicity_2019$ethnicity)))
),
stat = "identity",
position = "stack"
) +
labs(
x = "Educational attainment",
y = "Proportion of Population 25 years or older",
title = "Bay Area educational attainment by ethnicity",
fill = "Ethnicity"
) +
coord_flip() +
theme(
legend.position = "bottom",
legend.direction = "vertical"
) +
guides(
fill = guide_legend(
reverse = T
)
)
bay_education_ethnicity_2019_fill <-
bay_education_ethnicity_2019
bay_education_ethnicity_2019_stacked
bay_education_ethnicity_2019_fill
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(censusapi)
library(sf)
library(mapview)
library(tigris)
Sys.setenv(CENSUS_KEY="c18a7f6e5cbbd1e7f0d3047d8b674cbaad89bcb3")
acs_vars_2019_5yr <-
listCensusMetadata(
name = "2019/acs/acs5",
type = "variables"
)
library(tidyverse)
library(censusapi)
library(sf)
library(mapview)
library(tigris)
library(readxl)
Sys.setenv(CENSUS_KEY="c18a7f6e5cbbd1e7f0d3047d8b674cbaad89bcb3")
temp <- tempfile()
download.file("https://oehha.ca.gov/media/downloads/calenviroscreen/document/calenviroscreen40resultsdatadictionaryf2021.zip",destfile = temp)
ces4 <- read_excel(
unzip(
temp,
"calenviroscreen40resultsdatadictionary_F_2021.xlsx"
),
sheet = "CES4.0FINAL_results"
)
library(tidyverse)
library(censusapi)
library(sf)
library(mapview)
library(tigris)
library(readxl)
Sys.setenv(CENSUS_KEY="c18a7f6e5cbbd1e7f0d3047d8b674cbaad89bcb3")
temp <- tempfile()
download.file("https://oehha.ca.gov/media/downloads/calenviroscreen/document/calenviroscreen40resultsdatadictionaryf2021.zip",destfile = temp)
ces4 <- read_excel(
unzip(
temp,
"calenviroscreen40resultsdatadictionary_F_2021.xlsx"
),
sheet = "CES4.0FINAL_results"
)
library(tidyverse)
library(censusapi)
library(sf)
library(mapview)
library(tigris)
library(readxl)
Sys.setenv(CENSUS_KEY="c18a7f6e5cbbd1e7f0d3047d8b674cbaad89bcb3")
temp <- tempfile()
download.file("https://oehha.ca.gov/media/downloads/calenviroscreen/document/calenviroscreen40resultsdatadictionaryf2021.zip",destfile = temp)
ces4 <- read_excel(
unzip(
temp,
"calenviroscreen40resultsdatadictionary_F_2021.xlsx"
),
sheet = "CES4.0FINAL_results"
)
library(tidyverse)
library(censusapi)
library(sf)
library(mapview)
library(tigris)
library(readxl)
Sys.setenv(CENSUS_KEY="c18a7f6e5cbbd1e7f0d3047d8b674cbaad89bcb3")
temp <- tempfile()
download.file("https://oehha.ca.gov/media/downloads/calenviroscreen/document/calenviroscreen40resultsdatadictionaryf2021.zip",destfile = temp)
ces4 <- read_excel(
unzip(
temp,
"calenviroscreen40resultsdatadictionary_F_2021.xlsx"
),
sheet = "CES4.0FINAL_results"
)
library(tidyverse)
library(censusapi)
library(sf)
library(mapview)
library(tigris)
library(readxl)
Sys.setenv(CENSUS_KEY="c18a7f6e5cbbd1e7f0d3047d8b674cbaad89bcb3")
temp <- tempfile()
download.file("https://oehha.ca.gov/media/downloads/calenviroscreen/document/calenviroscreen40resultsdatadictionaryf2021.zip",destfile = temp)
ces4 <- read_excel(
unzip(
temp,
"calenviroscreen40resultsdatadictionary_F_2021.xlsx",
),
sheet = "CES4.0FINAL_results"
)
library(tidyverse)
library(censusapi)
library(sf)
library(mapview)
library(tigris)
library(readxl)
Sys.setenv(CENSUS_KEY="c18a7f6e5cbbd1e7f0d3047d8b674cbaad89bcb3")
ces4 <- read_excel(
unzip(
temp,
"calenviroscreen40resultsdatadictionary_F_2021.xlsx",
),
sheet = "CES4.0FINAL_results"
)
setwd("~/Documents/GitHub/ctbeck.github.io")
ces4 <- read_excel(
"calenviroscreen40resultsdatadictionary_F_2021.xlsx",
sheet = "CES4.0FINAL_results"
)
View(ces4)
library(tidyverse)
library(censusapi)
library(sf)
library(mapview)
library(tigris)
library(readxl)
Sys.setenv(CENSUS_KEY="c18a7f6e5cbbd1e7f0d3047d8b674cbaad89bcb3")
ces4 <- read_excel(
"calenviroscreen40resultsdatadictionary_F_2021.xlsx",
sheet = "CES4.0FINAL_results"
)
colnames(ces4)
colnames(ces4)
ces4_clean <- ces4 %>%
select(!ends_with("Pctl"))
ces4_clean <- ces4 %>%
select(!ends_with("Pctl"))
colnames(ces4)
colnames(ces4)
ces4_clean <- ces4 %>%
select(!ends_with("Pctl"))
colnames(ces4_clean)
ces4_clean <- ces4 %>%
select(!ends_with("Pctl", "Percentile"))
ces4_clean <- ces4 %>%
select(!ends_with("Pctl", "Percentile"))
colnames(ces4)
ces4_clean <- ces4 %>%
select(!ends_with("Pctl", "Percentile"))
colnames(ces4)
ces4_clean <- ces4 %>%
select(!ends_with("Pctl"))
colnames(ces4_clean)
sum(is.na(ces4_clean$Poverty))
ces4_clean %>%
.$Poverty
ces4_clean %>%
# .$Poverty
pull(Poverty)
ces4_clean %>%
# .$Poverty
pull(Poverty)
is.na()  %>%
sum()
ces4_clean %>%
# .$Poverty
pull(Poverty)
is.na() %>%
sum()
ces4_clean %>%
# .$Poverty
pull(Poverty)
is.na() %>%
sum()
ca_tracts <- tracts("CA")
ca_tracts <- tracts("CA")
ces4_map <- ces4_clean  %>%
##create geometry info and nothing else
left_join(
ca_tracts  %>%
select(GEOID),
by = c("Census tract" = "GEOID")
)
class(ces4$`Census Tract`)
ces4_clean %>%
# .$Poverty %>%
pull(Poverty) %>%
is.na() %>%
sum()
class(ca_tracts$GEOID)
ca_tracts <- tracts("CA")
ces4_map <- ces4_clean  %>%
##create geometry info and nothing else
left_join(
ca_tracts  %>%
select(GEOID) %>%
mutate(GEOID = as.numeric(GEOID)),
by = c("Census tract" = "GEOID") ##problem is that ces4_clean is numberic and ca_tracts GEOID is characteer
)
ca_tracts <- tracts("CA")
ces4_map <- ces4_clean  %>%
##create geometry info and nothing else
left_join(
ca_tracts  %>%
select(GEOID) %>%
mutate(GEOID = GEOID %>% as.numeric()),
by = c("Census tract" = "GEOID") ##problem is that ces4_clean is numberic and ca_tracts GEOID is characteer
)
ces4_map <- ces4_clean  %>%
##create geometry info and nothing else
left_join(
ca_tracts  %>%
select(GEOID) %>%
mutate(GEOID = GEOID %>% as.numeric()),
by = c("Census tract" = "GEOID") ##problem is that ces4_clean is numberic and ca_tracts GEOID is characteer
)
ces4_map <- ces4_clean  %>%
##create geometry info and nothing else
left_join(
ca_tracts  %>%
select(GEOID) %>%
mutate(GEOID = GEOID %>% as.numeric())
ca_tracts <- tracts("CA")
ca_tracts <- tracts("CA")
ces4_map <- ces4_clean  %>%
##create geometry info and nothing else
left_join(
ca_tracts  %>%
transmute(GEOID = GEOID %>% as.numeric()),
by = c("Census tract" = "GEOID") ##problem is that ces4_clean is numberic and ca_tracts GEOID is characteer
)
ces4_map <- ces4_clean %>%
left_join(
ca_tracts %>%
transmute(GEOID = GEOID %>% as.numeric()),
by = c("Census Tract" = "GEOID")
)
ces4_map <- ces4_clean %>%
left_join(
ca_tracts %>%
transmute(GEOID = GEOID %>% as.numeric()),
by = c("Census Tract" = "GEOID")
) %>%
##make it spacial object
st_as_sf()
ces4_map <- ces4_clean %>%
left_join(
ca_tracts %>%
transmute(GEOID = GEOID %>% as.numeric()),
by = c("Census Tract" = "GEOID")
) %>%
##make it spatial object
st_as_sf()
```{r}
library(tidyverse)
library(censusapi)
library(sf)
library(mapview)
library(tigris)
library(readxl)
Sys.setenv(CENSUS_KEY="c18a7f6e5cbbd1e7f0d3047d8b674cbaad89bcb3")
ces4 <- read_excel(
"calenviroscreen40resultsdatadictionary_F_2021.xlsx",
sheet = "CES4.0FINAL_results"
)
colnames(ces4)
##clean up the dataset
ces4_clean <- ces4 %>%
select(!ends_with("Pctl"))
##check for missing values
sum(is.na(ces4_clean$Poverty))
##manipulate the data to see the column values of poverty, is the same concept as line 33
ces4_clean %>%
# .$Poverty %>%
pull(Poverty) %>%
is.na() %>%
sum()
ca_tracts <- tracts("CA")
ces4_map <- ces4_clean %>%
left_join(
ca_tracts %>%
transmute(GEOID = GEOID %>% as.numeric()),
by = c("Census Tract" = "GEOID")
) %>%
##make it spatial object
st_as_sf()
mapview(ces4_map, zcol = "Asthma")
