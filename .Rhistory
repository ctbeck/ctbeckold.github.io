)
)
smc_blocks_2020 <- blocks("CA", "Santa Clara", year = 2020, progress_bar = F)
nfo_boundary <- places("CA", progress_bar = F) %>%
filter(NAME == "Los Altos")
nfo_pop_2020 <- smc_pop_race_2020 %>%
left_join(smc_blocks_2020 %>% select(block = GEOID20)) %>%
st_as_sf() %>%
st_centroid() %>%
.[nfo_boundary, ] %>%
st_drop_geometry()  %>%
left_join(smc_blocks_2020 %>% select(block = GEOID20)) %>%
st_as_sf()
mapview(nfo_pop_2020, zcol = "pop")
smc_blocks_2020 <- blocks("CA", "Santa Clara", year = 2020, progress_bar = F)
nfo_boundary <- places("CA", progress_bar = F) %>%
filter(NAME == "Los Altos")
nfo_pop_2020 <- smc_pop_race_2020 %>%
left_join(smc_blocks_2020 %>% select(block = GEOID20)) %>%
st_as_sf() %>%
st_centroid() %>%
.[nfo_boundary, ] %>%
smc_blocks_2020 <- blocks("CA", "Santa Clara", year = 2020, progress_bar = F)
smc_blocks_2020 <- blocks("CA", "Santa Clara", year = 2020, progress_bar = F)
nfo_boundary <- places("CA", progress_bar = F) %>%
filter(NAME == "Los Altos")
nfo_pop_2020 <- smc_pop_race_2020 %>%
left_join(smc_blocks_2020 %>% select(block = GEOID20)) %>%
st_as_sf() %>%
st_centroid() %>%
.[nfo_boundary, ] %>%
st_drop_geometry(NULL)  %>%
left_join(smc_blocks_2020 %>% select(block = GEOID20)) %>%
st_as_sf()
smc_blocks_2020 <- blocks("CA", "Santa Clara", year = 2020, progress_bar = F)
smc_blocks_2020 <- blocks("CA", "Santa Clara", year = 2020, progress_bar = F)
la_boundary <- places("CA", progress_bar = F) %>%
filter(NAME == "Los Altos")
la_pop_2020 <- smc_pop_race_2020 %>%
left_join(smc_blocks_2020 %>% select(block = GEOID20)) %>%
st_as_sf() %>%
st_centroid() %>%
.[la_boundary, ] %>%
st_drop_geometry()  %>%
left_join(smc_blocks_2020 %>% select(block = GEOID20)) %>%
st_as_sf()
mapview(la_pop_2020, zcol = "pop")
smc_blocks_2020 <- blocks("CA", "Santa Clara", year = 2020, progress_bar = F)
smc_blocks_2020 <- blocks("CA", "Santa Clara", year = 2020, progress_bar = F)
la_boundary <- places("CA", progress_bar = F) %>%
filter(NAME == "Los Altos")
la_pop_2020 <- smc_pop_race_2020 %>%
left_join(smc_blocks_2020 %>% select(block = GEOID20)) %>%
st_as_sf() %>%
st_centroid() %>%
.[la_boundary, ] %>%
st_drop_geometry()  %>%
left_join(smc_blocks_2020 %>% select(block = GEOID20)) %>%
st_as_sf()
smc_blocks_2020 <- blocks("CA", "Santa Clara", year = 2020, progress_bar = F)
la_boundary <- places("CA", progress_bar = F) %>%
filter(NAME == "Los Altos")
la_pop_2020 <- smc_pop_race_2020 %>%
left_join(smc_blocks_2020 %>% select(block = GEOID20)) %>%
st_as_sf() %>%
st_centroid() %>%
.[la_boundary, ] %>%
st_drop_geometry()  %>%
left_join(smc_blocks_2020 %>% select(block = GEOID20)) %>%
st_as_sf()
smc_blocks_2020 <- blocks("CA", "Santa Clara", year = 2020, progress_bar = F)
la_boundary <- places("CA", progress_bar = F) %>%
filter(NAME == "Los Altos")
la_pop_2020 <- smc_blocks_2020
smc_pop_race_2020 %>%
left_join(smc_pop_race_2020 %>% select(block = GEOID20)) %>%
st_as_sf() %>%
st_centroid() %>%
.[la_boundary, ] %>%
st_drop_geometry()  %>%
left_join(smc_pop_race_2020 %>% select(block = GEOID20)) %>%
st_as_sf()
smc_blocks_2020 <- blocks("CA", "Santa Clara", year = 2020, progress_bar = F)
la_boundary <- places("CA", progress_bar = F) %>%
filter(NAME == "Los Altos")
la_pop_2020 <- smc_blocks_2020
smc_pop_race_2020 %>%
left_join(smc_blocks_2020 %>% select(block = GEOID20)) %>%
st_as_sf() %>%
st_centroid() %>%
.[la_boundary, ] %>%
st_drop_geometry()  %>%
left_join(smc_pop_race_2020 %>% select(block = GEOID20)) %>%
st_as_sf()
smc_blocks_2020 <- blocks("CA", "Santa Clara", year = 2020, progress_bar = F)
la_boundary <- places("CA", progress_bar = F) %>%
filter(NAME == "Los Altos")
la_pop_2020 <- smc_blocks_2020
smc_pop_race_2020 %>%
left_join(smc_blocks_2020 %>% select(block = GEOID20)) %>%
st_as_sf() %>%
st_centroid() %>%
.[la_boundary, ] %>%
st_drop_geometry()  %>%
## left_join(smc_pop_race_2020 %>% select(block = GEOID20)) %>%
st_as_sf()
smc_blocks_2020 <- blocks("CA", "Santa Clara", year = 2020, progress_bar = F)
la_boundary <- places("CA", progress_bar = F) %>%
filter(NAME == "Los Altos")
la_pop_2020 <- smc_blocks_2020
smc_pop_race_2020 %>%
left_join(smc_blocks_2020 %>% select(block = GEOID20)) %>%
st_as_sf() %>%
st_centroid() %>%
.[la_boundary, ] %>%
st_drop_geometry()  %>%
left_join(smc_blocks_2020 %>% select(block = GEOID20)) %>%
st_as_sf()
mapview(la_pop_2020, zcol = "pop")
smc_blocks_2020 <- blocks("CA", "Santa Clara", year = 2020, progress_bar = F)
la_boundary <- places("CA", progress_bar = F) %>%
filter(NAME == "Los Altos")
la_pop_2020 <- smc_blocks_2020
smc_pop_race_2020 %>%
left_join(smc_blocks_2020 %>% select(block = GEOID20)) %>%
st_as_sf() %>%
st_centroid() %>%
.[la_boundary, ] %>%
st_drop_geometry()  %>%
left_join(smc_blocks_2020 %>% select(block = GEOID20)) %>%
st_as_sf()
mapview(smc_blocks_2020, zcol = "pop")
smc_blocks_2020 <- blocks("CA", "Santa Clara", year = 2020, progress_bar = F)
la_boundary <- places("CA", progress_bar = F) %>%
filter(NAME == "Los Altos")
la_pop_2020 <- smc_blocks_2020
smc_pop_race_2020 %>%
left_join(smc_blocks_2020 %>% select(block = GEOID20)) %>%
st_as_sf() %>%
st_centroid() %>%
.[la_boundary, ] %>%
st_drop_geometry()  %>%
left_join(smc_blocks_2020 %>% select(block = GEOID20)) %>%
st_as_sf()
mapview(la_pop_2020, zcol = "pop")
smc_blocks_2020 <- blocks("CA", "Santa Clara", year = 2020, progress_bar = F)
la_boundary <- places("CA", progress_bar = F) %>%
filter(NAME == "Los Altos")
la_pop_2020 <-  smc_pop_race_2020 %>%
left_join(smc_blocks_2020 %>% select(block = GEOID20)) %>%
st_as_sf() %>%
st_centroid() %>%
.[la_boundary, ] %>%
st_drop_geometry()  %>%
left_join(smc_blocks_2020 %>% select(block = GEOID20)) %>%
st_as_sf()
mapview(la_pop_2020, zcol = "pop")
smc_blocks_2020 <- blocks("CA", "Santa Clara", year = 2020, progress_bar = F)
la_boundary <- places("CA", progress_bar = F) %>%
filter(NAME == "Los Altos")
la_pop_2020 <-  smc_pop_race_2020 %>%
left_join(smc_blocks_2020 %>% select(block = GEOID20)) %>%
st_as_sf() %>%
st_centroid() %>%
.[la_boundary, ] %>%
st_drop_geometry()  %>%
left_join(smc_blocks_2020 %>% select(block = GEOID20)) %>%
st_as_sf()
mapview(la_pop_2020, zcol = "pop") + mapview(smc_blocks_2020, alpha.regions = 0)
smc_pop_race_2020 <- smc_pop_race_2020 %>%
View(smc_pop_race_2020)
View(smc_pop_race_2010)
smc_pop_race_2020 <- smc_pop_race_2020 %>%
View(smc_blocks_2020)
View(smc_pop_2020)
View(smc_pop_2020)
View(smc_pop_2020)
View(smc_pop_2020)
View(smc_pop_2020)
View(smc_pop_2020)
View(smc_pop_2020)
smc_blocks_2020 <- blocks("CA", "Santa Clara", year = 2020, progress_bar = F)
la_pop_2020 <-  smc_blocks_2020 %>%
st_centroid() %>%
.[la_boundary, ] %>%
st_drop_geometry()  %>%
left_join(smc_blocks_2020 %>% select(block = GEOID20)) %>%
st_as_sf()
la_boundary
a_pop_2020 <-  smc_blocks_2020 %>%
st_centroid() %>%
.[la_boundary, ] %>%
st_drop_geometry()  %>%
left_join(smc_blocks_2020, by = c("GEOID20"= "GEOID")) %>% ##when joining two cols you need to specify what cols to join across the two datasets
st_as_sf()
View(la_boundary)
View(la_boundary)
la_pop_2020 <-  smc_blocks_2020 %>%
st_centroid() %>%
.[la_boundary, ] %>%
st_drop_geometry()  %>%
left_join(smc_blocks_2020 %>% select(GEOID20)) %>% ##when joining two cols you need to specify what cols to join across the two datasets
st_as_sf() %>%
select(GEOID20) %>%
left_join(smc_pop_race_2020)
smc_blocks_2020 <- blocks("CA", "Santa Clara", year = 2020, progress_bar = F)
la_boundary <- places("CA", progress_bar = F) %>%
filter(NAME == "Los Altos")
la_blocks_2020 <-  smc_blocks_2020 %>%
st_centroid() %>%
.[la_boundary, ] %>%
st_drop_geometry()  %>%
left_join(smc_blocks_2020 %>% select(GEOID20)) %>% ##when joining two cols you need to specify what cols to join across the two datasets
st_as_sf() %>%
select(GEOID20) %>%
left_join(smc_pop_race_2020)
la_boundary <- places("CA", progress_bar = F) %>%
filter(NAME == "Los Altos")
la_blocks_2020 <-  smc_blocks_2020 %>%
st_centroid() %>%
.[la_boundary, ] %>%
st_drop_geometry()  %>%
left_join(smc_blocks_2020 %>% select(GEOID20)) %>% ##when joining two cols you need to specify what cols to join across the two datasets
st_as_sf() %>%
select(GEOID20) %>%
left_join(smc_pop_race_2020)
la_blocks_2020 <-  smc_blocks_2020 %>%
st_centroid() %>%
.[la_boundary, ] %>%
st_drop_geometry()  %>%
left_join(smc_blocks_2020 %>% select(GEOID20)) %>%
st_as_sf() %>%
select(GEOID20) %>%
left_join(smc_pop_race_2020)
la_blocks_2020 <-  smc_blocks_2020 %>%
st_centroid() %>%
.[la_boundary, ] %>%
st_drop_geometry()  %>%
left_join(smc_blocks_2020 %>% select(GEOID20)) %>% ##when joining two cols you need to specify what cols to join across the two datasets
st_as_sf() %>%
la_blocks_2020 <-  smc_blocks_2020 %>%
st_centroid() %>%
.[la_boundary, ] %>%
st_drop_geometry()  %>%
left_join(smc_blocks_2020 %>% select(GEOID20)) %>% ##when joining two cols you need to specify what cols to join across the two datasets
st_as_sf() %>%
select(GEOID20) %>%
la_blocks_2020 <-  smc_blocks_2020 %>%
st_centroid() %>%
.[la_boundary, ] %>%
st_drop_geometry()  %>%
left_join(smc_blocks_2020 %>% select(GEOID20)) %>% ##when joining two cols you need to specify what cols to join across the two datasets
st_as_sf() %>%
select(GEOID20) %>%
left_join(smc_pop_race_2020)
colnames(smc_pop_race_2020)
la_pop_2020 <- smc_pop_2020 %>%
##la_blocks_2020 <-  smc_blocks_2020 %>%
st_centroid() %>%
.[la_boundary, ] %>%
st_drop_geometry()  %>%
left_join(smc_blocks_2020 %>% select(GEOID20)) %>% ##when joining two cols you need to specify what cols to join across the two datasets
st_as_sf() %>%
select(GEOID20) %>%
left_join(smc_pop_race_2020)
la_pop_2020 <- smc_pop_2020 %>%
la_blocks_2020 <-  smc_blocks_2020 %>%
st_centroid() %>%
.[la_boundary, ] %>%
st_drop_geometry()  %>%
left_join(smc_blocks_2020 %>% select(GEOID20)) %>% ##when joining two cols you need to specify what cols to join across the two datasets
st_as_sf() %>%
select(GEOID20) %>%
left_join(smc_pop_race_2020)
la_pop_2020 <- smc_pop_2020 %>%
left_join(smc_blocks_2020 %>% select(GEOID20)) %>% ##when joining two cols you need to specify what cols to join across the two datasets
st_as_sf() %>%
st_centroid() %>%
.[la_boundary, ] %>%
st_drop_geometry()  %>%
select(GEOID20) %>%
left_join(smc_blocks_2020 %>% select(GEOID20)) %>%
```{r}
la_boundary <- places("CA", progress_bar = F) %>%
filter(NAME == "Los Altos")
la_pop_2020 <- smc_pop_2020 %>%
left_join(smc_blocks_2020 %>% select(GEOID20)) %>% ##when joining two cols you need to specify what cols to join across the two datasets
st_as_sf() %>%
st_centroid() %>%
.[la_boundary, ] %>%
st_drop_geometry()  %>%
select(GEOID20) %>%
left_join(smc_blocks_2020 %>% select(GEOID20)) %>%
mapview(la_pop_2020, zcol = "pop") ## mapview(smc_blocks_2020, alpha.regions = 0)
smc_pop_race_2020 <- smc_pop_race_2020 %>%
mutate(
race = case_when(
category1 == "Population of two or more races:" & is.na(category2) ~ "Two or more races",
category1 == "Population of two or more races:" ~ "",
!is.na(category2) ~ category2,
TRUE ~ ""
)
)
smc_pop_race_2020 <- smc_pop_race_2020 %>%
mutate(
race = case_when(
category1 == "Population of two or more races:" & is.na(category2) ~ "Two or more races",
category1 == "Population of two or more races:" ~ "",
!is.na(category2) ~ category2,
TRUE ~ ""
)
)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(sf)
library(tigris)
library(censusapi)
library(mapview)
library(tidycensus)
library(leaflet)
Sys.setenv(CENSUS_KEY ="c18a7f6e5cbbd1e7f0d3047d8b674cbaad89bcb3")
setwd("~/Documents/GitHub/ctbeck.github.io")
bay_income_race_2019 <- getCensus(
name = "acs/acs5", ##5 year survey
vintage = 2019,
region = "county 001,012,041 075, 081, 085, 095, 097:", ## 9 counties in Bay Area
regionin = "state:06",
vars = "group(B19001A)"
)
bay_income_race_2019 <- getCensus(
name = "acs/acs5", ##5 year survey
vintage = 2019,
region = "county 001,012,041 075, 081, 085, 095, 097:", ## 9 counties in Bay Area
regionin = "state:06",
vars = "group(B19001A)"
)
bay_income_race_2019 <- getCensus(
name = "acs/acs5", ##5 year survey
vintage = 2019,
region = "county 001,012,041 075, 081, 085, 095, 097:", ## 9 counties in Bay Area
regionin = "state:06",
vars = "group(B19001A)"
)
library(tidyverse)
library(sf)
library(tigris)
library(censusapi)
library(mapview)
library(tidycensus)
library(leaflet)
Sys.setenv(CENSUS_KEY ="c18a7f6e5cbbd1e7f0d3047d8b674cbaad89bcb3")
bay_income_race_2019 <- getCensus(
name = "acs/acs5", ##5 year survey
vintage = 2019,
region = "county 001,012,041 075, 081, 085, 095, 097:", ## 9 counties in Bay Area
regionin = "state:06",
vars = "group(B19001A)"
)
bay_income_race_2019 <- getCensus(
name = "acs/acs5",
vintage = "2019",
region = "county:001,013,041,055,075,081,085,095,097",
regionin = "state:06",
vars = "group(B19001A)"
)
bay_income_race_2019 <- getCensus(
name = "acs/acs5",
vintage = "2019",
region = "county:001,013,041,055,075,081,085,095,097",
regionin = "state:06",
vars = "group(B19001A)"
) %>%
select(
ends_with("E")
)
bay_income_white_2019 <- getCensus(
name = "acs/acs5",
vintage = "2019",
region = "county:001,013,041,055,075,081,085,095,097",
regionin = "state:06",
vars = "group(B19001A)"
) %>%
select(
ends_with("E")
)
View(bay_income_white_2019)
bay_income_white_2019 <- getCensus(
name = "acs/acs5",
vintage = "2019",
region = "county:001,013,041,055,075,081,085,095,097",
regionin = "state:06",
vars = "group(B19001A)"
) %>%
select(
ends_with("E")  & -c(state, NAME)
)
View(bay_income_white_2019)
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(sf)
library(tigris)
library(censusapi)
library(mapview)
library(tidycensus)
library(leaflet)
library(readxl)
Sys.setenv(CENSUS_KEY ="c18a7f6e5cbbd1e7f0d3047d8b674cbaad89bcb3")
census_race_categories <-
c(
"White Alone",
"Black or African American",
"American Indian and Alaska Native Alone",
"Asian Alone",
"Native Hawaiian and Other Pacific Islander Alone",
"Some Other Race Alone",
"Two or More Races"
)
bay_ed_race <-
1:7 %>%
map_dfr(function(x){
getCensus(
name = "acs/acs5",
vintage = 2019,
region = "county:085",
regionin = "state:06",
vars = paste0("group(C15002",LETTERS[x],")")
) %>%
select(!c(GEO_ID,state,county,NAME) & !ends_with(c("EA","MA","M"))) %>%
pivot_longer(
ends_with("E"),
names_to = "name",
values_to = "estimate"
) %>%
left_join(
acs_vars_2019_5yr %>%
select(name, label)
) %>%
select(-name) %>%
separate(
label,
into = c(NA,NA,NA,"education"),
sep = "!!"
) %>%
group_by(education) %>%
summarize(across(everything(), sum)) %>%
filter(!is.na(education)) %>%
mutate(race = census_race_categories[x])
})
bay_race_total <-
bay_ed_race %>%
group_by(race) %>%
summarize(estimate = sum(estimate)) %>%
mutate(education = "Total")
bay_ed_race %>%
group_by(education, race) %>%
summarize(estimate = sum(estimate)) %>%
rbind(bay_race_total) %>%
ggplot() +
geom_bar(
aes(
x = education %>% factor(levels = rev(c("Total",unique(bay_ed_race$education)))),
y = estimate,
fill = race %>% factor(levels = rev(unique(bay_ed_race$race)))
),
stat = "identity",
position = "fill"
) +
labs(
x = "Educational Attainment",
y = "Proportion of Population 25 years or older",
title = "San Mateo County Educational Attainment by race",
fill = "Race"
) +
coord_flip() +
theme(
legend.position = "bottom",
legend.direction = "vertical"
)  +
guides(
fill = guide_legend(
reverse = T
)
)
bay_ed_race %>%
group_by(education, race) %>%
summarize(estimate = sum(estimate)) %>%
ggplot() +
geom_bar(
aes(
x = education,
y = estimate,
fill = race
),
stat = "identity",
position = "stack"
) +
labs(
x = "Educational Attainment",
y = "Proportion of Population 25 years or older",
title = "San Mateo County Educational Attainment by race",
fill = "Race"
) +
coord_flip()
library(tidyverse)
library(sf)
library(tigris)
library(censusapi)
library(mapview)
library(tidycensus)
library(leaflet)
library(readxl)
Sys.setenv(CENSUS_KEY ="c18a7f6e5cbbd1e7f0d3047d8b674cbaad89bcb3")
