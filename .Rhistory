into = c(NA,NA,NA,"education"),
sep = "!!"
) %>%
filter(!is.na(education)) %>%
mutate(ethnicity = census_ethnicity_categories$category[x])
})
census_ethnicity_categories <- data.frame(
code = c("H", "I"),
category =
c(
"White Not Latinx",
"Latinx"
)
)
bay_ed_ethnicity <-
1:2 %>%
map_dfr(function(x){
getCensus(
name = "acs/acs1",
vintage = 2019,
region = "county:085",
regionin = "state:06",
vars = paste0("group(C15002",census_ethnicity_categories$code[x],")")
) %>%
select(!c(GEO_ID,state,county,NAME) & !ends_with(c("EA","MA","M"))) %>%
pivot_longer(
ends_with("E"),
names_to = "name",
values_to = "estimate"
) %>%
left_join(
acs_vars_2019_1yr %>%
select(name, label)
) %>%
select(-name) %>%
separate(
label,
into = c(NA,NA,NA,"education"),
sep = "!!"
) %>%
filter(!is.na(education)) %>%
mutate(ethnicity = census_ethnicity_categories$category[x])
})
View(bay_ed_ethnicity)
knitr::opts_chunk$set(echo = FALSE)
bay_education_ethnicity_2019_stacked <- ##Lets you add a total ethnicity
bay_education_ethnicity_2019 %>%
rbind(bay_education_ethnicity_2019
%>%
group_by(ethnicity) %>%
summarize(estimate = sum(estimate)) %>%
mutate(education = "Total")
) %>%
ggplot() +
geom_bar(
aes(
x = education%>% factor(levels = unique(bay_education_total_2019$education)),
y = estimate,
fill = ethnicity %>% factor(levels = unique(bay_education_total_2019$ethnicity))
),
stat = "identity",
position = "stack"
) +
labs(
x = "Educational attainment",
y = "Population 25 years or older",
title = "Bay Area educational attainment by ethnicity",
fill = "Ethnicity"
) +
coord_flip() +
theme(
legend.position = "bottom",
legend.direction = "vertical"
) +
guides(
fill = guide_legend(
reverse = T
)
)
census_ethnicity_categories <- data.frame(
code = c("H", "I"),
category =
c(
"White Not Latinx",
"Latinx"
)
)
bay_ed_ethnicity <-
1:2 %>%
map_dfr(function(x){
getCensus(
name = "acs/acs1",
vintage = 2019,
region = "county:085",
regionin = "state:06",
vars = paste0("group(C15002",census_ethnicity_categories$code[x],")")
) %>%
select(!c(GEO_ID,state,county,NAME) & !ends_with(c("EA","MA","M"))) %>%
pivot_longer(
ends_with("E"),
names_to = "name",
values_to = "estimate"
) %>%
left_join(
acs_vars_2019_1yr %>%
select(name, label)
) %>%
select(-name) %>%
separate(
label,
into = c(NA,NA,NA,"education"),
sep = "!!"
) %>%
filter(!is.na(education)) %>%
mutate(ethnicity = census_ethnicity_categories$category[x])
})
library(tidyverse)
library(sf)
library(tigris)
library(censusapi)
library(mapview)
library(tidycensus)
library(leaflet)
library(readxl)
Sys.setenv(CENSUS_KEY ="c18a7f6e5cbbd1e7f0d3047d8b674cbaad89bcb3")
acs_vars_2019_5yr <-
listCensusMetadata(
name = "2019/acs/acs5",
type = "variables"
)
acs_vars_2019_1yr <-
listCensusMetadata(
name = "2019/acs/acs1",
type = "variables"
)
census_ethnicity_categories <- data.frame(
code = c("H", "I"),
category =
c(
"White Not Latinx",
"Latinx"
)
)
bay_ed_ethnicity <-
1:2 %>%
map_dfr(function(x){
getCensus(
name = "acs/acs1",
vintage = 2019,
region = "county:085",
regionin = "state:06",
vars = paste0("group(C15002",census_ethnicity_categories$code[x],")")
) %>%
select(!c(GEO_ID,state,county,NAME) & !ends_with(c("EA","MA","M"))) %>%
pivot_longer(
ends_with("E"),
names_to = "name",
values_to = "estimate"
) %>%
left_join(
acs_vars_2019_1yr %>%
select(name, label)
) %>%
select(-name) %>%
separate(
label,
into = c(NA,NA,NA,"education"),
sep = "!!"
) %>%
filter(!is.na(education)) %>%
mutate(ethnicity = census_ethnicity_categories$category[x])
})
bay_education_total_2019 <-
getCensus(
name = "acs/acs1",
vintage = 2019,
region = "county:085",
regionin = "state:06",
vars = "group(C15002)"
) %>%
select(!c(GEO_ID,state,county,NAME) & !ends_with(c("EA","MA","M"))) %>%
pivot_longer(
ends_with("E"),
names_to = "name",
values_to = "estimate"
) %>%
left_join(
acs_vars_2019_1yr %>%
select(name, label)
) %>%
select(-name) %>%
separate(
label,
into = c(NA,NA,NA,"education"),
sep = "!!"
) %>%
filter(!is.na(education)) %>%
mutate(
ethnicity = "Total",
education = case_when(
education %in% c("Less than 9th grade", "9th to 12th grade, no diploma") ~ "Less than high school diploma",
education == "High school graduate (includes equivalency)" ~ education,
education %in% c("Some college, no degree", "Associate's degree") ~ "Some college or associate's degree",
education %in% c("Bachelor's degree", "Graduate or professional degree") ~ "Bachelor's degree or higher"
)
) %>%
group_by(education, ethnicity) %>%
summarize_all(sum) ##syntax method equiv. to above
##Doing all of the above to the Latinx/White not Latinx Dataset
bay_education_ethnicity_2019 <-
bay_ed_ethnicity %>%
group_by(education, ethnicity) %>%
summarize_all(sum) %>%
rbind(bay_education_total_2019) %>%
pivot_wider(
names_from = "ethnicity",
values_from = "estimate"
) %>%
mutate(
`Not White, not Latinx` = Total - Latinx - `White Not Latinx`
) %>%
select(-Total) %>%
pivot_longer(
-c(education), ##left out of original
names_to = "ethnicity",
values_to = "estimate"
)
bay_education_ethnicity_2019_stacked <- ##Lets you add a total ethnicity
bay_education_ethnicity_2019 %>%
rbind(bay_education_ethnicity_2019
%>%
group_by(ethnicity) %>%
summarize(estimate = sum(estimate)) %>%
mutate(education = "Total")
) %>%
ggplot() +
geom_bar(
aes(
x = education%>% factor(levels = unique(bay_education_total_2019$education)),
y = estimate,
fill = ethnicity %>% factor(levels = unique(bay_education_total_2019$ethnicity))
),
stat = "identity",
position = "stack"
) +
labs(
x = "Educational attainment",
y = "Population 25 years or older",
title = "Bay Area educational attainment by ethnicity",
fill = "Ethnicity"
) +
coord_flip() +
theme(
legend.position = "bottom",
legend.direction = "vertical"
) +
guides(
fill = guide_legend(
reverse = T
)
)
bay_education_ethnicity_2019_fill <-
bay_education_ethnicity_2019
bay_education_ethnicity_2019_stacked
bay_education_ethnicity_2019_stacked <- ##Lets you add a total ethnicity
bay_education_ethnicity_2019 %>%
rbind(bay_education_ethnicity_2019
%>%
group_by(ethnicity) %>%
summarize(estimate = sum(estimate)) %>%
mutate(education = "Total")
) %>%
ggplot() +
geom_bar(
aes(
x = education%>% factor(levels = unique(bay_education_total_2019$education)),
y = estimate,
fill = ethnicity %>% factor(levels = unique(bay_education_total_2019$ethnicity))
),
stat = "identity",
position = "stack"
) +
labs(
x = "Educational attainment",
y = "Population 25 years or older",
title = "Bay Area educational attainment by ethnicity",
fill = "Ethnicity"
) +
coord_flip()
##Lets you add a total ethnicity
bay_education_ethnicity_2019 %>%
rbind(bay_education_ethnicity_2019
%>%
group_by(ethnicity) %>%
summarize(estimate = sum(estimate)) %>%
mutate(education = "Total")
) %>%
ggplot() +
geom_bar(
aes(
x = education%>% factor(levels = unique(bay_education_total_2019$education)),
y = estimate,
fill = ethnicity %>% factor(levels = unique(bay_education_total_2019$ethnicity))
),
stat = "identity",
position = "stack"
) +
labs(
x = "Educational attainment",
y = "Population 25 years or older",
title = "Bay Area educational attainment by ethnicity",
fill = "Ethnicity"
) +
coord_flip()
bay_education_ethnicity_2019_stacked <- ##Lets you add a total ethnicity
bay_education_ethnicity_2019 %>%
rbind(bay_education_ethnicity_2019
%>%
group_by(ethnicity) %>%
summarize(estimate = sum(estimate)) %>%
mutate(education = "Total")
) %>%
ggplot() +
geom_bar(
aes(
x = education%>% factor(levels = unique(bay_education_total_2019$education)),
y = estimate,
fill = ethnicity %>% factor(levels = unique(bay_education_total_2019$ethnicity))
),
stat = "identity",
position = "stack"
) +
labs(
x = "Educational attainment",
y = "Population 25 years or older",
title = "Bay Area educational attainment by ethnicity",
fill = "Ethnicity"
) +
coord_flip() +
theme(
legend.position = "bottom",
legend.direction = "vertical"
) +
guides(
fill = guide_legend(
reverse = T
)
)
bay_education_ethnicity_2019_stacked <- ##Lets you add a total ethnicity
bay_education_ethnicity_2019 %>%
rbind(bay_education_ethnicity_2019
%>%
group_by(ethnicity) %>%
summarize(estimate = sum(estimate)) %>%
mutate(education = "Total")
) %>%
ggplot() +
geom_bar(
aes(
x = education%>% factor(levels = unique(bay_education_total_2019$education)),
y = estimate,
fill = ethnicity %>% factor(levels = unique(bay_education_total_2019$ethnicity))
),
stat = "identity",
position = "stack"
) +
labs(
x = "Educational attainment",
y = "Population 25 years or older",
title = "Bay Area educational attainment by ethnicity",
fill = "Ethnicity"
) +
coord_flip() +
theme(
legend.position = "bottom",
legend.direction = "vertical"
) +
guides(
fill = guide_legend(
reverse = T
)
)
bay_education_ethnicity_2019_stacked <- ##Lets you add a total ethnicity
bay_education_ethnicity_2019 %>%
rbind(bay_education_ethnicity_2019
%>%
group_by(ethnicity) %>%
summarize(estimate = sum(estimate)) %>%
mutate(education = "Total")
) %>%
ggplot() +
geom_bar(
aes(
x = education%>% factor(levels = unique(bay_education_total_2019$education)),
y = estimate,
fill = ethnicity %>% factor(levels = unique(bay_education_total_2019$ethnicity))
),
stat = "identity",
position = "fill"
) +
labs(
x = "Educational attainment",
y = "Population 25 years or older",
title = "Bay Area educational attainment by ethnicity",
fill = "Ethnicity"
) +
coord_flip() +
theme(
legend.position = "bottom",
legend.direction = "vertical"
) +
guides(
fill = guide_legend(
reverse = T
)
)
bay_education_ethnicity_2019_stacked <- ##Lets you add a total ethnicity
bay_education_ethnicity_2019 %>%
rbind(bay_education_ethnicity_2019
%>%
group_by(ethnicity) %>%
summarize(estimate = sum(estimate)) %>%
mutate(education = "Total")
) %>%
ggplot() +
geom_bar(
aes(
x = education%>% factor(levels = rev(c(
"Total",
"Less than high school diploma",
"High school graduate (includes equivalency)",
"Some college or associate's degree",
"Bachelor's degree or higher"
))),
y = estimate,
fill = ethnicity %>% factor(levels = rev(c(
"Latinx",
"White Not Latinx",
"Not White, Not Latinx"
)))
),
stat = "identity",
position = "stack"
) +
labs(
x = "Educational attainment",
y = "Population 25 years or older",
title = "Bay Area educational attainment by ethnicity",
fill = "Ethnicity"
) +
coord_flip() +
theme(
legend.position = "bottom",
legend.direction = "vertical"
) +
guides(
fill = guide_legend(
reverse = T
)
)
bay_education_ethnicity_2019_fill <-
bay_education_ethnicity_2019
bay_education_ethnicity_2019_stacked
bay_education_ethnicity_2019_fill
bay_education_ethnicity_2019_stacked <- ##Lets you add a total ethnicity
bay_education_ethnicity_2019 %>%
rbind(bay_education_ethnicity_2019
%>%
group_by(ethnicity) %>%
summarize(estimate = sum(estimate)) %>%
mutate(education = "Total")
) %>%
ggplot() +
geom_bar(
aes(
x = education%>% factor(levels = rev(c(
"Total",
"Less than high school diploma",
"High school graduate (includes equivalency)",
"Some college or associate's degree",
"Bachelor's degree or higher"
))),
y = estimate,
fill = ethnicity %>% factor(levels = rev(c(
"Latinx",
"White Not Latinx",
"Not White, Not Latinx"
)))
),
stat = "identity",
position = "stack"
) +
labs(
x = "Educational attainment",
y = "Population 25 years or older",
title = "Bay Area educational attainment by ethnicity",
fill = "Ethnicity"
) +
coord_flip() +
theme(
legend.position = "bottom",
legend.direction = "vertical"
) +
guides(
fill = guide_legend(
reverse = T
)
)
bay_education_ethnicity_2019_fill <-
bay_education_ethnicity_2019
bay_education_ethnicity_2019_stacked
bay_education_ethnicity_2019_fill
